<!DOCTYPE html>
<html>
<head>
    <title>Treason Coup</title>
    <link rel="stylesheet" href="lib/bootstrap.min.css">
    <link rel="stylesheet" href="client.css">
    <script src="lib/jquery-2.1.4.js"></script>
    <script src="lib/knockout-3.3.0.debug.js"></script>
    <script src="lib/knockout.mapping-debug.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="shared.js"></script>
    <script src="client.js"></script>
    <script src="version.js"></script>
</head>
<body>
    <div class="container" data-bind="visible: !playing()">
        <div class="row">
            <!-- Welcome screen -->
            <div class="col-xs-12">
                <div class="alert alert-danger" role="alert" data-bind="text: welcomeMessage, visible: welcomeMessage"></div>
                <h3>Treason Coup</h3>
                <p data-bind="text: version"></p>
                <form data-bind="submit: join">
                    <p><input type="text" placeholder="Name" data-bind="value: playerName"/></p>
                    <p><button class="btn btn-default" type="submit" data-bind="enable: playerName">Join game</button></p>
                </form>
                <p><a href="rules.html" target="blank">How to play</a></p>
            </div>
        </div>
    </div>

    <div class="container" style="display: none" data-bind="visible: playing()">
        <div class="row">
            <!-- Players -->
            <div class="col-xs-4">
                <ul class="list-group" data-bind="foreach: state.players">
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-xs-6" data-bind="css: { 'current-player' : $index() == $root.state.state.playerIdx() }">
                                <span data-bind="text: name, css: { 'dead-player' : influenceCount() == 0 }"></span>
                                <span class="badge" data-bind="text: '$' + cash(), visible: influenceCount() != 0"></span>
                            </div>
                            <div class="col-xs-6">
                                <!-- ko foreach: influence -->
                                    <span class="label" data-bind="text: role, css: labelClass(role(), revealed())"></span>
                                <!-- /ko -->
                            </div>
                        </div>
                    </li>
                </ul>
                <ul class="list-group">
                    <li class="list-group-item">
                        <a href="javascript: null" data-bind="click: showChat, visible: sidebar() != 'chat'">Chat</a>
                        <div data-bind="visible: sidebar() == 'chat'">
                            <div class="chat"></div>
                            <textarea class="form-control" rows="2" placeholder="Chat message"></textarea>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <a href="javascript: null" data-bind="click: showCheatSheet, visible: sidebar() != 'cheat'">Cheat sheet</a>
                        <div data-bind="visible: sidebar() == 'cheat'">
                            <p><span class="label label-ambassador">ambassador</span> Draw two from the deck and optionally exchange your infuences</p>
                            <p><span class="label label-assassin">assassin</span> Pay $3 to reveal another player's influence; blocked by contessa</p>
                            <p><span class="label label-captain">captain</span> Steal $2 from another player; blocked by captain and ambassador</p>
                            <p><span class="label label-contessa">contessa</span> Block assassination</p>
                            <p><span class="label label-duke">duke</span> Tax +$3; block foreign aid</p>
                            <p>Income +$1</p>
                            <p>Foreign aid +$2; blocked by duke</p>
                            <p>Coup to reveal another player's influence for $7</p>
                        </div>
                    </li>
                </ul>
                <a href="rules.html" target="blank">How to play</a>
            </div>
            <!-- Activity -->
            <div class="col-xs-8 activity">
                <ul class="list-group">
                    <li class="list-group-item">
                        <div data-bind="visible: state.state.name() == 'waiting-for-players'">
                            <p>Waiting for players</p>
                            <p>
                                <button class="btn btn-default" data-bind="click: addAi">Add AI</button>
                                <button class="btn btn-default" data-bind="click: start, visible: state.numPlayers() >= 2">Start</button>
                            </p>
                        </div>
                        <div data-bind="visible: weAreInState('start-of-turn')">
                            <!-- ko if: !targetedAction() -->
                                Your turn:
                                <!-- ko foreach: Object.keys(actions).sort() -->
                                    <button class="btn btn-default" data-bind="text: $data, enable: canPlayAction($data), click: playAction"></button>
                                <!-- /ko -->
                            <!-- /ko -->
                            <!-- ko if: targetedAction -->
                                <span data-bind="text: targetedAction"></span>:
                                <!-- ko foreach: state.players -->
                                    <!-- ko if: canTarget($index()) -->
                                        <button class="btn btn-default" data-bind="text: name, click: function () { playTargetedAction($index()); }"></button>
                                    <!-- /ko -->
                                <!-- /ko -->
                                <button class="btn btn-link" data-bind="click: cancelAction">back</button>
                            <!-- /ko -->
                        </div>
                        <div data-bind="visible: theyAreInState('start-of-turn')">
                            Waiting for <span data-bind="text: currentPlayerName()"></span> to play
                        </div>
                        <div data-bind="visible: theyAreInState('exchange')">
                            Waiting for <span data-bind="text: currentPlayerName()"></span> to exchange roles
                        </div>
                        <div data-bind="visible: weAreInState('exchange')">
                            Choose <span data-bind="text: ourInfluenceCount()"></span> roles to keep:<br/>
                            <!-- ko foreach: state.state.exchangeOptions -->
                                <span data-bind="text: $data"></span>
                                <input type="checkbox" data-bind="attr: { 'data-role': $data }"></input>
                                <br/>
                            <!-- /ko -->
                            <button class="btn btn-default" data-bind="click: exchange">Exchange</button>
                        </div>
                        <div data-bind="visible: weAreInState('action-response')">
                            <span data-bind="text: actionText()"></span><br/>
                            Waiting for blocks/challenges
                        </div>
                        <div data-bind="visible: theyAreInState('action-response')">
                            <span data-bind="text: actionText()"></span><br/>
                            <!-- ko if: !weAreAlive() -->
                                Waiting for blocks/challenges
                            <!-- /ko -->
                            <!-- ko if: weAreAlive() -->
                                <button class="btn btn-default" data-bind="click: allow, css: { 'btn-success': weAllowed() }">Allow</button>
                                <!-- ko if: weCanBlock() -->
                                    <!-- ko foreach: blockingRoles() -->
                                        <button class="btn btn-default" data-bind="click: block, text: 'Block with ' + $data"></button>
                                    <!-- /ko -->
                                <!-- /ko -->
                                <button class="btn btn-default" data-bind="click: challenge, visible: weCanChallenge()">Challenge</button>
                            <!-- /ko -->
                        </div>
                        <div data-bind="visible: weAreInState('final-action-response')">
                            Waiting for blocks
                        </div>
                        <div data-bind="visible: theyAreInState('final-action-response')">
                            <!-- ko if: !weCanBlock() -->
                                Waiting for blocks
                            <!-- /ko -->
                            <!-- ko if: weCanBlock() -->
                                <button class="btn btn-default" data-bind="click: allow, css: { 'btn-success': weAllowed() }">Allow</button>
                                <!-- ko foreach: blockingRoles() -->
                                    <button class="btn btn-default" data-bind="click: block, text: 'Block with ' + $data"></button>
                                <!-- /ko -->
                            <!-- /ko -->
                        </div>
                        <div data-bind="visible: weAreTargeted('block-response')">
                            <span data-bind="text: actionText()"></span><br/>
                            Waiting for challenges
                        </div>
                        <div data-bind="visible: theyAreTargeted('block-response') &amp;&amp; weAreAlive()">
                            <span data-bind="text: actionText()"></span><br/>
                            <!-- ko if: !weAreAlive() -->
                                Waiting for challenges
                            <!-- /ko -->
                            <!-- ko if: weAreAlive() -->
                                <button class="btn btn-default" data-bind="click: allow, css: { 'btn-success': weAllowed() }">Allow</button>
                                <button class="btn btn-default" data-bind="click: challenge, visible: weCanChallenge()">Challenge</button>
                            <!-- /ko -->
                        </div>
                        <div data-bind="visible: weAreInState('game-won')">
                            You have won!<br/>
                            <button class="btn btn-default" data-bind="click: join">Play again</button>
                        </div>
                        <div data-bind="visible: theyAreInState('game-won')">
                            <span data-bind="text: currentPlayerName()"></span> has won!
                            <button class="btn btn-default" data-bind="click: join">Play again</button>
                        </div>
                        <div data-bind="visible: weMustReveal()">
                            Must reveal an influence
                            <!-- ko foreach: ourInfluence() -->
                            <button class="btn btn-xs" data-bind="text: role, css: buttonClass(role()), visible: !revealed(), click: reveal"></button>
                            <!-- /ko -->
                        </div>
                        <div data-bind="visible: theyMustReveal()">
                            Waiting for <span data-bind="text: toRevealPlayerName()"></span> to reveal an influence
                        </div>
                    </li>
                    <!-- ko foreach: history -->
                        <li class="list-group-item" data-bind="text: displayHistory($data)"></li>
                    <!-- /ko -->
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
